

{% extends "Shared/Layout.html" %} {% block username %}{{username}}{% endblock %}
{% block content %}
{% load static %}
{% csrf_token %}

 <!-- Custom styles for this html-->
 <link href="{% static 'css/masters.css' %}" rel="stylesheet" type="text/css" >
 <link href="{% static 'css/table.css' %}" rel="stylesheet" type="text/css" >
 <link href="{% static 'css/activebtn.css' %}" rel="stylesheet" type="text/css" >

 <link rel="stylesheet" type="text/css" href="{% static 'css/tooltips.css' %}" />

 <script src="{% static 'jquery/dist/jquery.min.js' %}"></script>
 <!-- Include DataTables CSS -->
 <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">
 <!-- Include DataTables JS -->
 <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<!-- Selectize.js CSS -->
<link href="{% static 'css/selectize.min.css' %}" rel="stylesheet" type="text/css" >
<!-- Selectize.js JS -->
<script src="{% static 'js/selectize.min.js' %}"></script>

<style>
  .card{
    padding:0 !important
  }
</style>

      <!-- Statistics Summary -->
<!-- Statistics Summary -->
<!-- Top Summary Card -->
<div class="card mb-4 shadow-sm">
    <div class="card-body">
        <div class="row text-center">
            <div class="col-md-4 border-end">
                <h6 class="text-muted text-uppercase">Total Fields</h6>
                <h2 class="fw-bold" id="total-fields">{{ comparison_data|length }}</h2>
            </div>
            <div class="col-md-4 border-end">
                <h6 class="text-muted text-uppercase">Changed Values</h6>
                <h2 class="fw-bold text-warning" id="changed-fields">0</h2>
            </div>
            <div class="col-md-4">
                <h6 class="text-muted text-uppercase">Unchanged</h6>
                <h2 class="fw-bold text-success" id="unchanged-fields">0</h2>
            </div>
        </div>
    </div>
</div>

<!-- Comparison Section -->
<div class="row mb-4">
    <!-- Old Values Card -->
    <div class="col-md-6">
        <div class="card border-start border-primary border-4 shadow-sm h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Previous Values</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for item in comparison_data %}
                        {% with index=forloop.counter0 %}
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ item.label }}</label>
                            <div class="position-relative">
                                <input type="text"
                                    class="form-control {% if item.old_value != item.new_value %}border-warning{% endif %}"
                                    style="{% if item.old_value != item.new_value %}background-color: #fcff33;{% endif %}"
                                    value="{{ item.old_value }}"
                                    disabled
                                    data-index="{{ forloop.counter0 }}"
                                    data-type="old">



                            </div>
                        </div>
                        {% endwith %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- New Values Card -->
    <div class="col-md-6">
        <div class="card border-start border-success border-4 shadow-sm h-100">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0">New Values</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for item in comparison_data %}
                        {% with index=forloop.counter0 %}
                        <div class="col-md-4 mb-3">
                            <label class="form-label">{{ item.label }}</label>
                            <div class="position-relative">
                               <input type="text"
                                    class="form-control {% if item.old_value != item.new_value %}border-warning{% endif %}"
                                    style="{% if item.old_value != item.new_value %}background-color: #fcff33;{% endif %}"
                                    value="{{ item.new_value }}"
                                    disabled
                                    data-index="{{ forloop.counter0 }}"
                                    data-type="new">


                                {% comment %} {% if item.old_value != item.new_value %}
                                    <span class="position-absolute top-0 end-0 translate-middle badge bg-danger">!</span>
                                {% endif %} {% endcomment %}
                            </div>
                        </div>
                        {% endwith %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>



<!-- JavaScript for Count -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const totalFields = {{ comparison_data|length }};
        let changedCount = 0;

        for (let i = 0; i < totalFields; i++) {
            const oldInput = document.querySelector(`input[data-type="old"][data-index="${i}"]`);
            const newInput = document.querySelector(`input[data-type="new"][data-index="${i}"]`);

            if (!oldInput || !newInput) continue;

            const oldValue = oldInput.value.trim();
            const newValue = newInput.value.trim();

            if (oldValue !== newValue) {
                changedCount++;
            }

            // Optional: hover effect to highlight matching pairs
            [oldInput, newInput].forEach(input => {
                input.addEventListener('mouseenter', () => {
                    oldInput.classList.add('border-primary', 'border-2');
                    newInput.classList.add('border-primary', 'border-2');
                });

                input.addEventListener('mouseleave', () => {
                    oldInput.classList.remove('border-primary', 'border-2');
                    newInput.classList.remove('border-primary', 'border-2');
                });
            });
        }

        // Update counters
        document.getElementById('total-fields').textContent = totalFields;
        document.getElementById('changed-fields').textContent = changedCount;
        document.getElementById('unchanged-fields').textContent = totalFields - changedCount;
    });
</script>





{% if messages %}
{% for message in messages %}
  <script>
  Swal.fire({
    title: "{{ message.tags }}",
    text: "{{ message }}",
    icon: "{{ message.tags }}",
    confirmButtonText: "OK",
  });
</script>
{% endfor %}
{% endif %}

{% endblock %}